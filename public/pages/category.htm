<div id="category-div" >
    <div class="row">
        <div class="col s12">
            <span class="center-align"><h2 data-bind="text: name"></h2></span>
        </div>
    </div>
    <div class="row">
        <div data-bind="foreach: offers">
            <div class="row">
                <a data-bind="attr: { href: '#offer/' + $data.id }">
                    <div class="card horizontal hoverable">
                        <div class="card-image">
                            <img class="offer-image-preview" data-bind="attr: { src: $data.cover }">
                        </div>
                        <div class="card-stacked">
                            <div class="card-content">
                                <h5><!--ko text: title--><!--/ko--></h5>
                                <!--ko text: short_descr--><!--/ko-->
                            </div>
                            <!-- <div class="card-action">
                                <a href="#">This is a link</a>
                            </div> -->
                        </div>
                    </div>
                </a>
            </div>
        </div>
    </div>
</div>

<script>
    let CategoryViewModel = {
        // properties
        offers: ko.observableArray([]),
        name: ko.observable(''),
        // methods
        UpdateCategory: function() {
            RootViewModel.PreloaderShow();
            $.ajax({
                url: "api/categories/" + chunckParams['param'],
                type: 'GET'
            }).done(function(resp) {
                CategoryViewModel.name(resp.name);
                CategoryViewModel.offers([]);
                resp.offers.forEach(element => {
                    CategoryViewModel.offers.push(element);
                });
                RootViewModel.PreloaderHide();
            }).fail(function(xhr, status, text) {
                RootViewModel.PreloaderHide();
                alert("error: " + text);
            });
        }
    }

    // object activation
    ko.applyBindings(CategoryViewModel, document.getElementById("category-div"));

    // update news when main page becomes visible
    $(document).on("CategoryVisible", function () {
        CategoryViewModel.UpdateCategory();
    });
</script>
