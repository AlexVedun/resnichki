<div id="categories-div" >
    <div class="row">
        <div class="col s12">
            <span class="center-align"><h2>Категории</h2></span>
        </div>
    </div>
    <div class="row">
        <div class="" data-bind="foreach: categories">
            <a data-bind="attr: { href: '#category/' + $data.id }">
                <div class="card col s4 hoverable">
                    <div class="card-image">
                        <img data-bind="attr: { src: cover }" alt="Category">
                            <span class="card-title" data-bind="text: name"></span>
                        </div>
                                <!-- <div class="card-content">
                                    <p>I am a very simple card. I am good at containing small bits of information.
                                        I am convenient because I require little markup to use effectively.</p>
                                </div>
                                <div class="card-action">
                                    <a href="#">This is a link</a>
                                </div> -->
                    </div>
                </div>
            </a>
        </div>
    </div>
</div>

<script>
    let CategoriesViewModel = {
        // properties
        categories: ko.observableArray([]),
        // methods
        UpdateCategories: function() {
            RootViewModel.PreloaderShow();
            $.ajax({
                url: "api/categories",
                type: 'GET'
            }).done(function(resp) {
                CategoriesViewModel.categories([]);
                resp.forEach(element => {
                    element.link = '#category/' + element.id;
                    CategoriesViewModel.categories.push(element);
                });
                RootViewModel.PreloaderHide();
            }).fail(function(xhr, status, text) {
                RootViewModel.PreloaderHide();
                alert("error: " + text);
            });
        }
    }

    // object activation
    ko.applyBindings(CategoriesViewModel, document.getElementById("categories-div"));

    // update news when main page becomes visible
    $(document).on("CategoriesVisible", function () {
        CategoriesViewModel.UpdateCategories();
    });
</script>
