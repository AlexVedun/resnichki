<div id="admin-div" >
    <div class="row">
        <div class="card col s12">
            <div class="card-content" style="padding: 0px">
                <span class="center-align"><h3 class="truncate">Панель администратора</h3></span>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col s12">
            <ul class="admin-tabs tabs">
                <li class="tab col s4"><a class="active" href="#manage-users">Пользователи</a></li>
                <li class="tab col s4"><a href="#manage-offers">Предложения</a></li>
                <li class="tab col s4"><a href="#manage-categories">Категории</a></li>
            </ul>
        </div>
    <!-- Change user contacts -->
        <div id="manage-users">
            <div class="row"></div>
            <div class="row">
                <a class="col s12 m8 offset-m2 l6 offset-l3 xl4 offset-xl4 btn waves-effect waves-light" href="#add_user"><i class="material-icons left">add</i>Создать пользователя</a>
            </div>
            <form method="POST" id="manage-users-form" class="card col s12 m12 l12 xl12" data-bind="submit: SaveContacts">
                <div class="card-content">
                    <table class="highlight responsive-table">
                        <thead>
                            <tr>
                                <th>ФИО</th>
                                <th>e-mail</th>
                                <th>Тип</th>
                                <th>Роль</th>
                                <!-- <th>Категория</th>                                 -->
                                <th></th>
                            </tr>
                        </thead>
                        <tbody data-bind="foreach: usersList">
                            <tr>
                                <!-- <td data-bind="text: name"></td> -->
                                <td><a data-bind="attr: { href: '#user/' + id }, text: name"></a></td>
                                <td data-bind="text: email"></td>
                                <td data-bind="text: type"></td>
                                <td data-bind="text: role"></td>
                                <td><button class="btn waves-effect waves-light red" data-bind="click: function(data) { $root.DeleteUser(data) }"><i class="material-icons">delete</i></button></td>
                            </tr>
                        </tbody>
                    </table>
                    <!-- <div class="row input-field">
                        <i class="material-icons prefix">face</i>
                        <input id="contact_name" type="text" data-bind="value: contactsForm.contact_name">
                        <label class="active" for="contact_name">Контактное лицо</label>
                    </div>
                    <div class="row input-field">
                        <i class="material-icons prefix">phone</i>
                        <input id="phone" type="text" data-bind="value: contactsForm.phone">
                        <label class="active" for="phone">Рабочий телефон</label>
                    </div>
                    <div class="row input-field">
                        <i class="material-icons prefix">phone_android</i>
                        <input id="mobile_1" type="text" data-bind="value: contactsForm.mobile_1">
                        <label class="active" for="mobile_1">Мобильный телефон №1</label>
                    </div>
                    <div class="row input-field">
                        <i class="material-icons prefix">phone_android</i>
                        <input id="mobile_2" type="text" data-bind="value: contactsForm.mobile_2">
                        <label class="active" for="mobile_2">Мобильный телефон №2</label>
                    </div>
                    <div class="row input-field">
                        <i class="material-icons prefix">phone_android</i>
                        <input id="mobile_3" type="text" data-bind="value: contactsForm.mobile_3">
                        <label class="active" for="mobile_3">Мобильный телефон №3</label>
                    </div>
                    <div class="row input-field">
                        <i class="material-icons prefix">chat</i>
                        <input id="viber" type="text" data-bind="value: contactsForm.viber">
                        <label class="active" for="viber">Viber</label>
                    </div>
                    <div class="row input-field">
                        <i class="prefix icon ion-logo-whatsapp"></i>
                        <input id="whats_up" type="text" data-bind="value: contactsForm.whats_up">
                        <label class="active" for="whats_up">WhatsUp</label>
                    </div>
                    <div class="row input-field">
                        <i class="prefix icon ion-md-paper-plane"></i>
                        <input id="telegram" type="text" data-bind="value: contactsForm.telegram">
                        <label class="active" for="telegram">Telegram</label>
                    </div>
                    <div class="row input-field">
                        <i class="prefix icon ion-logo-skype"></i>
                        <input id="skype" type="text" data-bind="value: contactsForm.skype">
                        <label class="active" for="skype">Skype</label>
                    </div>
                    <div class="row input-field">
                        <i class="prefix icon ion-logo-vk"></i>
                        <input id="vkontakte" type="text" data-bind="value: contactsForm.vkontakte">
                        <label class="active" for="vkontakte">ВКонтакте</label>
                    </div>
                    <div class="row input-field">
                        <i class="prefix icon ion-logo-instagram"></i>
                        <input id="instagram" type="text" data-bind="value: contactsForm.instagram">
                        <label class="active" for="instagram">Instagram</label>
                    </div>
                    <div class="row input-field">
                        <i class="material-icons prefix">web</i>
                        <input id="web_site" type="text" data-bind="value: contactsForm.web_site">
                        <label class="active" for="web_site">Web-site</label>
                    </div> -->
                    <!-- <div class="row">
                        <button class="col s12 m8 offset-m2 l6 offset-l3 xl6 offset-xl3 btn waves-effect waves-light" type="submit">
                            <i class="material-icons left">save</i>
                            Сохранить
                        </button>
                    </div> -->
                </div>
            </form>
        </div>
    <!-- Change password section -->
        <div id="manage-offers">
            <div class="row"></div>
            <form method="POST" id="manage-offers-form" class="card col s12 m8 offset-m2 l8 offset-l2 xl6 offset-xl3" data-bind="submit: ChangePassword">

            </form>
        </div>
    <!-- Add, modify, remove offers -->
        <div id="manage-categories" class="row">
            <div class="row"></div>
            <div class="row">
                <a class="col s12 m8 offset-m2 l6 offset-l3 xl4 offset-xl4 btn waves-effect waves-light" href="#category_editor/0"><i class="material-icons left">add</i>Создать категорию</a>
            </div>
            <div class="col s12 m8 offset-m2 l8 offset-l2 xl8 offset-xl2 card">
                <div class="card-content">
                    <table class="highlight responsive-table">
                        <tbody data-bind="foreach: categoriesList">
                            <tr>
                                <td><img class="materialboxed" data-bind="attr: { src: cover }" style="width: 200px"></td>
                                <td><a data-bind="attr: { href: '#category_editor/' + id }, text: name"></a></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- <form id="offers-list-form" class="col s12 m8 offset-m2 l8 offset-l2 xl8 offset-xl2">
            </form> -->
        </div>
    </div>
</div>

<script>
    let AdminViewModel = {
        // properties
        usersList: ko.observableArray([]),
        categoriesList: ko.observableArray([]),
        // methods
        UpdateUsers: function() {
            RootViewModel.PreloaderShow();
            $.ajax({
                url: "api/user/get/all",
                type: 'GET',
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("Authorization", 'Bearer '+ Cookies.get('wedding_token') /* localStorage.getItem('wedding_token') */ );
                }
            }).done(function(resp) {
                AdminViewModel.usersList([]);
                for (const item of resp) {
                    switch(item.type) {
                        case 'ind':
                            item.type = 'Физическое лицо';
                            break;
                        case 'ent':
                            item.type = 'ФЛП';
                            break;
                        case 'firm':
                            item.type = 'Фирма';
                            break;
                    }
                    switch(item.role) {
                        case 'admin':
                            item.role = 'Администратор';
                            break;
                        case 'perf':
                            item.role = 'Исполнитель';
                            break;
                    }
                    AdminViewModel.usersList.push(item);
                }
                M.updateTextFields();
                RootViewModel.PreloaderHide();
            }).fail(function(xhr, status, text) {
                RootViewModel.PreloaderHide();
                HandleError(xhr, '#admin');
                //ShowModalError('#admin', xhr);
                //alert("error: " + text);
            });
        },
        DeleteUser: function(_user) {
            ShowYesNoModal('Внимание!', 'Эта операция необратима! Вы уверены?', '#admin', function() {
                RootViewModel.PreloaderShow();
                $.ajax({
                    url: "api/user/" + _user.id,
                    type: 'DELETE',
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader("Authorization", 'Bearer '+ Cookies.get('wedding_token') /* localStorage.getItem('wedding_token') */ );
                    }
                }).done(function(resp) {
                    AdminViewModel.usersList.remove(_user);
                    M.toast({html: 'Успешно удалено!', classes: 'rounded'});
                    RootViewModel.PreloaderHide();
                }).fail(function(xhr, status, text) {
                    RootViewModel.PreloaderHide();
                    HandleError(xhr, '#admin');
                    //alert("error: " + text);
                });
            });
        },
        UpdateCategories: function() {
            RootViewModel.PreloaderShow();
            $.ajax({
                url: "api/categories",
                type: 'GET'
            }).done(function(resp) {
                console.log(resp);
                AdminViewModel.categoriesList([]);
                for (const item of resp) {
                    AdminViewModel.categoriesList.push(item);
                }
                $('.materialboxed').materialbox();
                RootViewModel.PreloaderHide();
            }).fail(function(xhr, status, text) {
                RootViewModel.PreloaderHide();
                HandleError(xhr, '#admin');
                //ShowModalError('#categories', xhr);
                //alert("error: " + text);
            });
        },
        SaveContacts:function() {
            // let formData = ko.toJS(this.contactsForm);
            // RootViewModel.PreloaderShow();
            // $.ajax({
            //     url: "api/user/save/contacts",
            //     data: formData,
            //     type: 'POST',
            //     beforeSend: function (xhr) {
            //         xhr.setRequestHeader("Authorization", 'Bearer '+ Cookies.get('wedding_token') /* localStorage.getItem('wedding_token') */);
            //     }
            // }).done(function(resp) {
            //     M.toast({html: 'Изменения сохранены!', classes: 'rounded'});
            //     RootViewModel.PreloaderHide();
            // }).fail(function(xhr, status, text) {
            //     RootViewModel.PreloaderHide();
            //     ShowModalError('#performer', xhr);
            //     //alert("error: " + text);
            // });
        },
        ChangePassword: function() {
            // let formData = ko.toJS(this.changePasswordForm);
            // RootViewModel.PreloaderShow();
            // $.ajax({
            //     url: "api/user/password/change",
            //     data: formData,
            //     type: 'POST',
            //     beforeSend: function (xhr) {
            //         xhr.setRequestHeader("Authorization", 'Bearer '+ Cookies.get('wedding_token') /* localStorage.getItem('wedding_token') */);
            //     }
            // }).done(function(resp) {
            //     M.toast({html: resp.message, classes: 'rounded'});
            //     for (const key in PerformerViewModel.changePasswordForm) {
            //         if (PerformerViewModel.changePasswordForm.hasOwnProperty(key)) {
            //             const element = PerformerViewModel.changePasswordForm[key];
            //             element('');
            //         }
            //     }
            //     RootViewModel.PreloaderHide();
            // }).fail(function(xhr, status, text) {
            //     console.log(xhr);
            //     RootViewModel.PreloaderHide();
            //     ShowModalError('#performer', xhr);
            //     //alert("error: " + text);
            // });
        },
        GetOffersList: function() {
            // RootViewModel.PreloaderShow();
            // $.ajax({
            //     url: "api/offers/get",
            //     type: 'GET',
            //     beforeSend: function (xhr) {
            //         xhr.setRequestHeader("Authorization", 'Bearer '+ Cookies.get('wedding_token') /* localStorage.getItem('wedding_token') */ );
            //     }
            // }).done(function(resp) {
            //     console.log(resp);
            //     PerformerViewModel.OffersList([]);
            //     for (const item of resp) {
            //         PerformerViewModel.OffersList.push(item);
            //     }
            //     RootViewModel.PreloaderHide();
            // }).fail(function(xhr, status, text) {
            //     RootViewModel.PreloaderHide();
            //     ShowModalError('#performer', xhr);
            //     //alert("error: " + text);
            // });
        },
        DeleteOffer: function(_offer) {
            // RootViewModel.PreloaderShow();
            // $.ajax({
            //     url: "api/offers/" + _offer.id,
            //     type: 'DELETE',
            //     beforeSend: function (xhr) {
            //         xhr.setRequestHeader("Authorization", 'Bearer '+ Cookies.get('wedding_token') /* localStorage.getItem('wedding_token') */ );
            //     }
            // }).done(function(resp) {
            //     PerformerViewModel.OffersList.remove(_offer);
            //     M.toast({html: 'Успешно удалено!', classes: 'rounded'});
            //     RootViewModel.PreloaderHide();
            // }).fail(function(xhr, status, text) {
            //     RootViewModel.PreloaderHide();
            //     ShowModalError('#performer', xhr);
            //     //alert("error: " + text);
            // });
        }
    }

    // object activation
    ko.applyBindings(AdminViewModel, document.getElementById("admin-div"));

    // update news when main page becomes visible
    $(document).on("AdminVisible", function () {
        AdminViewModel.UpdateUsers();
        AdminViewModel.UpdateCategories();
    });

    // activate tabs
    $(document).ready(function(){
        $('.admin-tabs').tabs();
    });

    $(document).ready(function(){
        $('.materialboxed').materialbox();
    });

    // $(document).ready(function() {
    //     $('input#title-input, textarea#short-descr').characterCounter();
    // });

    // $(document).ready(function(){
    //     $('.fixed-action-btn').floatingActionButton();
    // });
</script>
